pipeline {
    agent any
    
    parameters{
        string(name: 'CANARY_WEIGHT', defaultValue: '20', description: 'Percentage canary deployment will be served instead of main')
    }

    stages {
        stage("Update Canary Ingress") {
            steps{
                script{
                    dir('Kubernetes/Canary'){
                        sh "envsubst < canary-ingress.yaml | kubectl apply -f -"
                    }
                }
            }
        }
    }
}